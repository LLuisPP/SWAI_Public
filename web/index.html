<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SWAI - Exoplanet Classifier</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
    h1 { font-size: 1.8rem; margin-bottom: .25rem; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 16px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    label { display:block; font-weight:600; margin-bottom:4px; }
    input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #cbd5e1; }
    button { padding: 10px 14px; border-radius: 12px; border: 0; background: #111827; color: #fff; font-weight: 600; cursor: pointer; }
    .muted{color:#6b7280}
    .pill { display:inline-block; padding: 4px 8px; border-radius: 999px; font-weight:700; }
    .pill.high { background:#ecfdf5; color:#065f46; }
    .pill.med { background:#fffbeb; color:#92400e; }
    .pill.low { background:#fef2f2; color:#991b1b; }
    .bar { height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden; }
    .bar>span { display:block; height:100%; background:#111827; width:0%;}
    .row{display:flex; align-items:center; gap:8px; margin:4px 0;}
    .footer{margin-top:24px; font-size:.9rem; color:#6b7280}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
</head>
<body>
  <h1>ü™ê SWAI - Exoplanet Classifier (Kepler+TESS)</h1>
  <p class="muted">Clasifica: <b>CONFIRMED / CANDIDATE / FALSE POSITIVE</b> - corre directamente en tu navegador.</p>

  <div class="card">
    <h2>Entrada manual</h2>
    <div class="grid">
      <div>
        <label>Orbital period (days)</label>
        <input id="orbital_period" type="number" step="0.1" value="10">
      </div>
      <div>
        <label>Transit duration (hours)</label>
        <input id="transit_duration" type="number" step="0.1" value="3">
      </div>
      <div>
        <label>Transit depth (ppm)</label>
        <input id="transit_depth" type="number" step="1" value="500">
      </div>
      <div>
        <label>Planet radius (R_earth)</label>
        <input id="planet_radius" type="number" step="0.1" value="2">
      </div>
    </div>
    <button id="predictBtn">Predecir</button>

    <div id="result" style="margin-top:16px"></div>
    <div id="probs"></div>
  </div>

  <div class="footer">
    Dataset: NASA Exoplanet Archive (KOI + TOI).  
    Modelo ligero entrenado en Python y exportado a ONNX.
  </div>

<script>
  const CONF_THRESHOLDS = {high: 0.75, medium: 0.55};
  const fmtPct = x => (x*100).toFixed(0) + '%';

  let meta = null, session = null;

  async function load() {
    meta = await fetch('meta.json').then(r=>r.json());
    session = await ort.InferenceSession.create('model.onnx', {
      executionProviders: ['wasm']
    });
    console.log("Output names:", session.outputNames);
  }

  function confidenceLabel(p) {
    if (p >= CONF_THRESHOLDS.high) return {text:'Alta', cls:'high', icon:'‚úÖ'};
    if (p >= CONF_THRESHOLDS.medium) return {text:'Media', cls:'med', icon:'üü°'};
    return {text:'Baja', cls:'low', icon:'‚ö†Ô∏è'};
  }

  async function predict() {
    const vals = [
      parseFloat(document.getElementById('orbital_period').value || '0'),
      parseFloat(document.getElementById('transit_duration').value || '0'),
      parseFloat(document.getElementById('transit_depth').value || '0'),
      parseFloat(document.getElementById('planet_radius').value || '0'),
    ];

    const inputName = session.inputNames[0];
    const input = new ort.Tensor('float32', new Float32Array(vals), [1, meta.features.length]);

	const outputs = await session.run({ [inputName]: input });
	let probs = outputs['output_probability']?.data
         || outputs[session.outputNames.find(n=>n.toLowerCase().includes('prob'))]?.data
         || outputs[session.outputNames[0]].data;

    for (const k of session.outputNames) {
      if (k.toLowerCase().includes('prob')) {
        probs = outputs[k].data;
        break;
      }
    }
    if (!probs) {
      probs = outputs[session.outputNames[0]].data;
    }

    const classes = meta.classes;
    let bestIdx = 0, bestP = probs[0];
    for (let i=1; i<probs.length; i++) {
      if (probs[i] > bestP) { bestP = probs[i]; bestIdx = i; }
    }

    const badge = confidenceLabel(bestP);
    document.getElementById('result').innerHTML =
      `<div class="pill ${badge.cls}">Confianza: ${fmtPct(bestP)} ${badge.icon} (${badge.text})</div>
       <h3>Predicci√≥n: ${classes[bestIdx]}</h3>`;

    const rows = classes.map((c,i)=>`
      <div class="row">
        <div style="width:160px">${c}</div>
        <div class="bar" style="flex:1"><span style="width:${probs[i]*100}%"></span></div>
        <div style="width:56px;text-align:right">${fmtPct(probs[i])}</div>
      </div>`).join('');
    document.getElementById('probs').innerHTML = `<h4>Distribuci√≥n de probabilidad</h4>${rows}`;
  }

  document.getElementById('predictBtn').addEventListener('click', predict);
  load();
</script>
</body>
</html>

